# Makefile for Distortion Engine Test
# Tests REAL engines from compiled library

CXX = clang++
CXXFLAGS = -std=c++17 -O2 -Wall -Wextra -Wno-unused-parameter -Wno-unused-variable -Wno-unused-private-field -Wno-extra-tokens -Wno-sign-compare
OBJCXXFLAGS = -fno-objc-arc

# JUCE paths
JUCE_PLUGIN_DIR = JUCE_Plugin
JUCE_HEADER_DIR = $(JUCE_PLUGIN_DIR)/JuceLibraryCode
JUCE_SOURCE_DIR = $(JUCE_PLUGIN_DIR)/Source
JUCE_TEST_DIR = $(JUCE_PLUGIN_DIR)/Tests

# Include paths
INCLUDES = -I$(JUCE_HEADER_DIR) \
           -I$(JUCE_SOURCE_DIR) \
           -I$(JUCE_TEST_DIR) \
           -I. \
           -IJUCE/modules

# JUCE defines
DEFINES = -DJUCE_GLOBAL_MODULE_SETTINGS_INCLUDED=1 \
          -DDEBUG=1 \
          -DJUCE_STANDALONE_APPLICATION=1 \
          -DJUCE_APP_VERSION=1.0.0 \
          -DJUCE_APP_VERSION_HEX=0x10000

# System frameworks for macOS
FRAMEWORKS = -framework AudioUnit \
            -framework AudioToolbox \
            -framework CoreAudio \
            -framework CoreMIDI \
            -framework Cocoa \
            -framework Carbon \
            -framework Foundation \
            -framework Accelerate \
            -framework CoreGraphics \
            -framework CoreText \
            -framework IOKit \
            -framework QuartzCore

# Source files - include necessary JUCE modules
SOURCES = test_distortion_engines.mm \
          $(JUCE_HEADER_DIR)/include_juce_core.mm \
          $(JUCE_HEADER_DIR)/include_juce_audio_basics.mm \
          $(JUCE_HEADER_DIR)/include_juce_dsp.mm \
          $(JUCE_SOURCE_DIR)/EngineFactory.cpp

# Target
TARGET = test_distortion_engines

# Build rule
$(TARGET): $(SOURCES)
	@echo "Building Distortion Engine Test..."
	@echo "Using source files and engine implementations..."
	$(CXX) $(CXXFLAGS) $(OBJCXXFLAGS) $(INCLUDES) $(DEFINES) -o $(TARGET) $(SOURCES) $(FRAMEWORKS)
	@echo "Build complete: $(TARGET)"

# Clean rule
clean:
	rm -f $(TARGET)

# Test rule
test: $(TARGET)
	@echo "Running Distortion Engine Test..."
	./$(TARGET)

# Help
help:
	@echo "Makefile for Distortion Engine Test"
	@echo ""
	@echo "Targets:"
	@echo "  build     - Build the test executable"
	@echo "  test      - Build and run the test"
	@echo "  clean     - Remove built files"
	@echo "  help      - Show this help"
	@echo ""
	@echo "This test uses the REAL engines from:"
	@echo "  $(JUCE_LIB)"

.PHONY: clean test help
.DEFAULT_GOAL := $(TARGET)